<?xml version='1.0' encoding='utf-8'?>
<openerp>
    <data>
<!-- Salesman Commission Main Menu-->

    <menuitem
        id="commission"
        name="Salespeople Commissions"
        parent="base.menu_base_partner"
        groups="group_comm_payment_manager"
        sequence="10"
        />

        <!-- View FORM Creation for the object salesman.commission.payment-->
        <record model="ir.ui.view" id="commission_payment_form">
            <field name="name">commission.payment.form</field>
            <field name="model">commission.payment</field>
            <field name="arch" type="xml">
                <form string="Pago de Comisiones" version="7.0">
                    <header>
                        <button icon="STOCK_OK" name="prepare" states="draft,open" string="Prepare" type="object"/>
                        <button icon="STOCK_OK" name="validate" states="open" string="Validate" type="object"/>
                        <button icon="STOCK_OK" name="action_draft" states="open,done" string="Set to Draft" type="object"/>
                        <button icon="gtk-print" name="%(report_commission_payment)d" states="done" string="Imprimir Borrador Comisiones" type="action"/>
                        <button icon="gtk-print" name="%(report_commission_payment)d" states="done" string="Imprimir Comisiones" type="action"/>
                        <field
                            name="state"
                            widget="statusbar"
                            statusbar_visible="draft,open,done"
                            statusbar_colors='{"cancel":"red","draft":"blue"}'
                            />
                    </header>
                    <sheet>
                        <div class="oe_right oe_button_box" style="width: 300px;" name="buttons">
                        </div>
                        <div class="oe_title">
                            <div class="oe_edit_only">
                                <label for="name"/>
                            </div>
                            <h1>
                                <field name="name" default_focus="1" placeholder="Commission Concept" />
                            </h1>
                            <group col="4" colspan="2">
                                <group col="2" colspan="2">
                                    <label for="date_start"/>
                                    <field name="date_start" nolabel="1"/>
                                    <field
                                        name="commission_type"
                                        widget="radio"
                                        string="Based on"
                                        />
                                    <field
                                        name="commission_policy_date_start"
                                        widget="radio"
                                        string='Computation begins on'
                                        />
                                    <field
                                        name="commission_salesman_policy"
                                        widget="radio"
                                        string="Salespeople from"
                                        />
                                </group>
                                <group col="2" colspan="2">
                                    <label for="date_stop"/>
                                    <field name="date_stop" nolabel="1"/>
                                    <field
                                        name="commission_scope"
                                        widget="radio"
                                        string="Compute on"
                                        />
                                    <field
                                        name="commission_policy_date_end"
                                        widget="radio"
                                        string='Computation ends on'
                                        />
                                    <field
                                        name="commission_baremo_policy"
                                        widget="radio"
                                        string='Baremo from'
                                        />
                                </group>
                                <group col="2" colspan="4">
                                    <label for="bar_id" string="Baremo to be used if not policy set on Partner:"/>
                                    <field colspan="2" name="bar_id" nolabel="1"/>
                                </group>
                            </group>
                        </div>
                        <group col="2" colspan="2">
                        </group>
                        <notebook colspan="6">
                            <page string="Salespeople">
                                <group col="2" colspan="2">
                                    <field name="user_ids" nolabel="1">
                                        <tree>
                                            <field name="name" string="Asesor"/>
                                        </tree>
                                    </field>
                                </group>
                            </page>
                            <page
                                string="Payments"
                                >
                                <label
                                    align="0.0"
                                    string="Seleccione los vouchers sobre los
                                    cuales desea calcular comisiones. Deje en
                                    blanco para que se autorellene con los
                                    parametros introducidos en Datos. Si
                                    selecciona un Voucher solo se haran los
                                    calculos sobre este unicamente. Puede
                                    editarse mientras este en Estado: INICIAL y
                                    EN PROCESO"
                                    />
                                <field
                                    name="voucher_ids"
                                    readonly="1"
                                    nolabel="1"
                                    >
                                    <tree string="Journal Items">
                                        <field name="journal_id"/>
                                        <field name="period_id"/>
                                        <field name="date"/>
                                        <field name="date_maturity"/>
                                        <field name="name"/>
                                        <field name="ref"/>
                                        <field name="partner_id"/>
                                        <field name="account_id"/>
                                        <field name="move_id"/>
                                        <field name="rec_invoice"/>
                                        <field name="debit" sum="Total Debit"/>
                                        <field name="credit" sum="Total Credit"/>
                                    </tree>
                                </field>
                            </page>
                            <page
                                string="Invoices"
                                >
                                <label align="0.0" string="Seleccione los vouchers sobre los cuales desea calcular comisiones. Deje en blanco para que se autorellene con los parametros introducidos en Datos. Si selecciona un Voucher solo se haran los calculos sobre este unicamente. Puede editarse mientras este en Estado: INICIAL y EN PROCESO"/>
                                <field
                                    name="invoice_ids"
                                    domain="[
                                        ('state', '=', 'paid'),
                                        ('type', '=', 'out_invoice'),
                                        ]"
                                    nolabel="1">
                                </field>
                            </page>
                        </notebook>
                        <notebook colspan="6">
                            <page string="Commissions by Salespeople">
                                <group col="2" colspan="2">
                                    <field name="total_comm"/>
                                </group>
                                <field name="saleman_ids" nolabel="1" widget="one2many_list" colspan="4"/>
                            </page>
                            <page
                                string="Commissions on Products"
                                attrs="{'invisible':[('commission_scope','!=','product_invoiced')]}"
                                >
                                <field
                                    name="comm_line_product_ids"
                                    nolabel="1"
                                    widget="one2many_list"
                                    colspan="4"
                                    >
                                    <tree>
                                        <field name="name"/>
                                        <field name="pay_date"/>
                                        <field name="pay_off"/>
                                        <field name="invoice_num"/>
                                        <field name="partner_id"/>
                                        <field name="saleman_id"/>
                                        <field name="pay_inv"/>
                                        <field name="inv_date"/>
                                        <field name="days"/>
                                        <field name="inv_subtotal"/>
                                        <field name="product_id"/>
                                        <field name="price_unit"/>
                                        <field name="price_subtotal"/>
                                        <field name="price_list"/>
                                        <field name="price_date"/>
                                        <field name="rate_item"/>
                                        <field name="rate_number"/>
                                        <field name="timespan"/>
                                        <field name="baremo_comm"/>
                                        <field name="commission"/>
                                    </tree>
                                </field>

                            </page>
                            <page
                                string="Commissions on Invoices"
                                attrs="{'invisible':[('commission_scope','!=','whole_invoice')]}"
                                >
                                <field
                                    name="comm_line_invoice_ids"
                                    nolabel="1"
                                    widget="one2many_list"
                                    colspan="4"
                                    >
                                    <tree>
                                        <field name="name"/>
                                        <field name="pay_date"/>
                                        <field name="invoice_num"/>
                                        <field name="partner_id"/>
                                        <field name="saleman_id"/>
                                        <field name="pay_inv"/>
                                        <field name="inv_date"/>
                                        <field name="days"/>
                                        <field name="inv_subtotal"/>
                                        <field name="rate_item"/>
                                        <field name="rate_number"/>
                                        <field name="timespan"/>
                                        <field name="baremo_comm"/>
                                        <field name="commission"/>
                                    </tree>
                                </field>
                            </page>
                            <page string="Affected Invoices">
                                <field name="comm_invoice_ids" nolabel="1">
                                    <tree>
                                        <field name="invoice_id"/>
                                    </tree>
                                </field>
                            </page>
                            <page string="Affected Payments">
                                <field name="comm_voucher_ids" nolabel="1">
                                    <tree>
                                        <field name="voucher_id"/>
                                        <field name="date"/>
                                    </tree>
                                </field>
                            </page>
                            <page string="Payment without Invoices">
                                <field colspan="6" name="uninvoiced_ids" nolabel="1">
                                    <tree>
                                        <field name="payment_id"/>
                                    </tree>
                                </field>
                            </page>
                            <page
                                string="Products w/o PriceList"
                                attrs="{'invisible':[('commission_scope','!=','product_invoiced')]}"
                                >
                                <field name="noprice_ids" nolabel="1">
                                    <tree>
                                        <field name="invoice_num"/>
                                        <field name="date"/>
                                        <field name="product_id"/>
                                    </tree>
                                </field>
                            </page>
                            <page
                                string="Item w/o Products"
                                attrs="{'invisible':[('commission_scope','!=','product_invoiced')]}"
                                >
                                <field name="sale_noids" nolabel="1">
                                    <tree>
                                        <field name="inv_line_id"/>
                                    </tree>
                                </field>
                            </page>
                        </notebook>
                    </sheet>
                </form>
            </field>
        </record>

        <!-- View LIST Creation for the object salesman.commission.payment -->
        <record model="ir.ui.view" id="commission_payment_tree">
            <field name="name">commission.payment.tree</field>
            <field name="model">commission.payment</field>
            <field name="arch" type="xml">
                <tree string="Pago de Comisiones">
                    <field name="name"/>
                    <field name="total_comm"/>
                    <field name="date_start"/>
                    <field name="date_stop"/>
                    <field name="state"/>
                </tree>
            </field>
        </record>

        <!-- Creating and Action to open the View LIST for the object salesman.commission.payment -->
        <record model="ir.actions.act_window" id="commission_payment_all_act">
            <field name="name">Comisiones</field>
            <field name="res_model">commission.payment</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
        </record>

        <!-- Creating a menu to use the action sales_commission_payment_all_act -->

        <menuitem
            name="All Commissions"
            id="commission_all_mi"
            action="commission_payment_all_act"
            icon="terp-project"
            parent="commission"/>

        <record model="ir.ui.view" id="commission_saleman_graph">
            <field name="name">commission.saleman.graph</field>
            <field name="model">commission.saleman</field>
            <field name="arch" type="xml">
                <graph type="bar" string="Pago de Comisiones">
                    <field name="saleman_id"/>
                    <field name="comm_total" operator="+"/>
                </graph>
            </field>
        </record>

        <record model="ir.ui.view" id="commission_saleman_tree">
            <field name="name">commission.saleman.tree</field>
            <field name="model">commission.saleman</field>
            <field name="arch" type="xml">
                <tree string="Pago de Comisiones">
                    <field name="saleman_id"/>
                    <field name="comm_total"/>
                </tree>
            </field>
        </record>

        <record model="ir.ui.view" id="commission_saleman_form">
            <field name="name">commission.saleman.form</field>
            <field name="model">commission.saleman</field>
            <field name="arch" type="xml">
                <form string="Pago de Comisiones" version="7.0">
                    <field name="saleman_id"/>
                    <field name="comm_total"/>
                </form>
            </field>
        </record>

        <record model="ir.ui.view" id="commission_lines_graph">
            <field name="name">commission.lines.graph</field>
            <field name="model">commission.lines</field>
            <field name="arch" type="xml">
                <graph string="Comisiones x Producto" type="bar">
                    <field name="days"/>
                    <field name="commission" operator="+"/>
                </graph>
            </field>
        </record>

        <record model="ir.ui.view" id="commission_lines_tree">
            <field name="name">commission.lines.tree</field>
            <field name="model">commission.lines</field>
            <field name="arch" type="xml">
                <tree string="Aqui se muestran todos los productos y sus respectivas comisiones">
                                        <field name="name"/>
                    <field name="pay_date"/>
                    <field name="pay_off"/>
                    <field name="concept"/>
                    <field name="invoice_num"/>
                    <field name="partner_id"/>
                    <field name="saleman_id"/>
                    <field name="pay_inv"/>
                    <field name="inv_date"/>
                    <field name="days"/>
                    <field name="inv_subtotal"/>
                    <field name="item"/>
                    <field name="price_unit"/>
                    <field name="price_subtotal"/>
                    <field name="price_list"/>
                    <field name="price_date"/>
                    <field name="rate_item"/>
                    <field name="rate_number"/>
                    <field name="timespan"/>
                    <field name="baremo_comm"/>
                    <field name="perc_iva"/>
                    <field name="perc_ret_iva"/>
                    <field name="perc_ret_im"/>
                    <field name="perc_ret_islr"/>
                    <field name="commission"/>
                </tree>
            </field>
        </record>

        <record model="ir.ui.view" id="commission_lines_form">
            <field name="name">commission.lines.form</field>
            <field name="model">commission.lines</field>
            <field name="arch" type="xml">
                <form string="Pago de Comisiones" version="7.0">
                    <field name="saleman_id"/>
                    <field name="item"/>
                    <field name="commission"/>
                </form>
            </field>
        </record>

        <record id="view_invoice_customer_last_payment" model="ir.ui.view">
            <field name="name">account.invoice.customer.last_payment</field>
            <field name="model">account.invoice</field>
            <field name="inherit_id" ref="account.invoice_form"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='move_id']" position="after">
                    <field name="date_last_payment"/>
                </xpath>
            </field>
        </record>
    </data>
</openerp>
