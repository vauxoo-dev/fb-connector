<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="salesman_report">
        <t t-call="web.basic_layout">
            
            <t t-call="commission_calculation.report_styles"/>
            
            <t t-set="o" t-value="o.with_context({'lang':o.salesman_id.partner_id.lang})" />
            <!--VARIABLES TO BE USED LATER-->
            <t t-set="comm_scope" t-value="o.commission_id.scope"/>
            <t t-if="o and 'company_id' in o">
                <t t-set="company" t-value="o.company_id"></t>
            </t>
            <t t-if="not o or not 'company_id' in o">
                <t t-set="company" t-value="res_company"></t>
            </t>
            <div class="page">
                <table width="100%">
                    <tbody>
                        <tr>
                            <td width="30%">
                                <img t-if="company.logo" t-att-src="'data:image/png;base64,%s' % to_text(company.logo)" style="max-height: 50px;"/>
                            </td>
                            <td width="70%" style="text-align:center;">
                                <t t-if="company.name"><h1 t-field="company.name"/></t>
                                <t>COMMISSION PAYMENT FROM <span t-field="o.commission_id.date_start"/> TO <span t-field="o.commission_id.date_stop"/></t><br/>
                                <t t-if="o.salesman_id"><span t-esc="o.salesman_id.name.upper()"/></t><t t-if="not o.salesman_id">NO SALESMAN SET (NEEDS TO BE FIXED)</t><br/>
                                <t><span t-field="o.currency_amount"/> <span t-esc="o.currency_id.name"/></t>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <!-- TODO: Migrate the report for scope of product_invoiced -->
                <!--<t t-if="comm_scope=='product_invoiced'">
                    <t t-set="cv_ids" t-value="o.comm_voucher_ids"/>
                    <t t-foreach="cv_ids" t-as="cv">
                      <t t-if="cv.commission">
                        <table class="basic_table"  width="100%">
                            <tbody>
                                <tr>
                                    <td>
                                        <para>TRANSACTION</para>
                                    </td>
                                    <td>
                                        <para>DATE</para>
                                    </td>
                                    <td>
                                        <para>AMOUNT</para>
                                    </td>
                                </tr>
                                <tr class="prueba">
                                    <td class="celdaAbstractTotal" width="33%">
                                        <span t-esc="cv.am_id.name.upper()"/>
                                    </td>
                                    <td class="celdaAbstractTotal" width="33%">
                                        <span t-esc="formatLang(cv.am_id.date, date=True)"/>
                                    </td>
                                    <td class="celdaAbstractTotal" width="33%">
                                        <span t-esc="cv.am_id.amount"/>
                                    </td>
                                </tr>
                            </tbody>
                        </table>

                        <t t-set="ci_ids" t-value="cv.comm_invoice_ids"/>
                        <t t-foreach="ci_ids" t-as="ci">
                          <t t-if="ci.commission">
                            <table class="basic_table"  width="100%">
                                <tbody>
                                    <tr>
                                        <td>
                                            <para>PARTNER</para>
                                        </td>
                                        <td>
                                            <para>INVOICE DATE</para>
                                        </td>
                                        <td>
                                            <para>INVOICE NUMBER</para>
                                        </td>
                                        <td>
                                            <para>INVOICE SUBTOTAL</para>
                                        </td>
                                        <td>
                                            <para>TAX %</para>
                                        </td>
                                        <td>
                                            <para>INVOICE TOTAL</para>
                                        </td>
                                    </tr>
                                    <tr class="prueba">
                                        <td class="celdaAbstractTotal" width="16.66%">
                                            <span t-esc="ci.invoice_id.partner_id.display_name.upper()"/>
                                        </td>
                                        <td class="celdaAbstractTotal" width="16.66%">
                                            <span t-esc="formatLang(ci.invoice_id.date_invoice, date=True)"/>
                                        </td>
                                        <td class="celdaAbstractTotal" width="16.66%">
                                            <span t-esc="ci.invoice_id.number.upper()"/>
                                        </td>
                                        <td class="celdaAbstractTotal" width="16.66%">
                                            <span t-esc="formatLang(ci.invoice_id.amount_untaxed, digits=2, grouping=3, monetary=True)"/>
                                        </td>
                                        <td class="celdaAbstractTotal" width="16.66%">
                                            <span t-esc="formatLang(((ci.invoice_id.amount_total / ci.invoice_id.amount_untaxed)-1)*100, digits=2, grouping=3, monetary=True)"/>
                                        </td>
                                        <td class="celdaAbstractTotal" width="16.66%">
                                            <span t-esc="formatLang(ci.invoice_id.amount_total, digits=2, grouping=3, monetary=True)"/>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>

                            <t t-set="cl_ids" t-value="ci.comm_line_ids "/>
                                <table class="basic_table"  width="100%">
                                    <tbody>
                                        <tr>
                                            <td>
                                                <para>PRODUCT</para>
                                            </td>
                                            <td>
                                                <para>INVOICED AMOUNT</para>
                                            </td>
                                            <td>
                                                <para>EMISSION DAYS</para>
                                            </td>
                                            <td>
                                                <para>BAREME DAYS</para>
                                            </td>
                                            <td>
                                                <para>BAREME COMMISSION %</para>
                                            </td>
                                            <td>
                                                <para>COMMISSION</para>
                                            </td>
                                        </tr>
                            <t t-foreach="cl_ids" t-as="cl">
                              <t t-if="cl.commission">
                                        <tr class="prueba">
                                            <td class="celdaAbstractTotal" width="16.66%">
                                                <span t-esc="cl.product_id.name.upper()"/>
                                            </td>
                                            <td class="celdaAbstractTotal" width="16.66%">
                                                <span t-esc="formatLang(cl.price_subtotal, digits=2, grouping=3, monetary=True)"/>
                                            </td>
                                            <td class="celdaAbstractTotal" width="16.66%">
                                                <span t-esc="cl.days"/>
                                            </td>
                                            <td class="celdaAbstractTotal" width="16.66%">
                                                <span t-esc="cl.timespan"/>
                                            </td>
                                            <td class="celdaAbstractTotal" width="16.66%">
                                                <span t-esc="cl.baremo_comm"/>
                                            </td>
                                            <td class="celdaAbstractTotal" width="16.66%">
                                                <span t-esc="formatLang(cl.commission_currency, digits=2, grouping=3, monetary=True)"/>
                                            </td>
                                        </tr>
                              </t>
                            </t>
                                    </tbody>
                                </table>
                          </t>
                        </t>
                      </t>
                    </t>
                </t>-->
                <t t-if="comm_scope=='whole_invoice'">
                    <table class="basic_table"  width="100%">
                        <tbody>
                            <t t-set="cl_ids" t-value="o.line_ids "/>
                            <tr>
                                <th class="celdaTituloTabla">
                                    <para>TRANSACTION</para>
                                </th>
                                <th class="celdaTituloTabla">
                                    <para>DATE</para>
                                </th>
                                <th class="celdaTituloTabla">
                                    <para>PARTNER</para>
                                </th>
                                <th class="celdaTituloTabla">
                                    <para>PAYMENT AMOUNT</para>
                                </th>
                                <th class="celdaTituloTabla">
                                    <para>INVOICE DATE</para>
                                </th>
                                <th class="celdaTituloTabla">
                                    <para>INVOICE NUMBER</para>
                                </th>
                                <th class="celdaTituloTabla">
                                    <para>INVOICE SUBTOTAL</para>
                                </th>
                                <th class="celdaTituloTabla">
                                    <para>TAX %</para>
                                </th>
                                <th class="celdaTituloTabla">
                                    <para>INVOICE TOTAL</para>
                                </th>
                                <th class="celdaTituloTabla">
                                    <para>INVOICE PAYMENT</para>
                                </th>
                                <th class="celdaTituloTabla">
                                    <para>BAREME DISCOUNT</para>
                                </th>
                                <th class="celdaTituloTabla">
                                    <para>START DATE</para>
                                </th>
                                <th class="celdaTituloTabla">
                                    <para>END DATE</para>
                                </th>
                                <th class="celdaTituloTabla">
                                    <para>DUE DAYS</para>
                                </th>
                                <th class="celdaTituloTabla">
                                    <para>BAREME DAYS</para>
                                </th>
                                <th class="celdaTituloTabla">
                                    <para>% COMMISSION</para>
                                </th>
                                <th class="celdaTituloTabla">
                                    <para>COMMISSION</para>
                                </th>
                            </tr>
                            <tr class="prueba" t-foreach="cl_ids" t-as="cl">
                                <t t-set="inv" t-value="cl.invoice_id"/>
                                <td class="celdaDetailLeft" width="5.00%">
                                    <span t-esc="cl.name.upper()"/>
                                </td>
                                <td class="celdaDetail" width="5.00%">
                                    <span t-field="cl.payment_date"/>
                                </td>
                                <td class="celdaDetailLeft" width="20.0%">
                                    <span t-esc="cl.partner_id.name.upper()"/>
                                </td>

                                <td class="celdaDetail" width="5.00%">
                                    <span t-field="cl.amount"/>
                                </td>
                                <td class="celdaDetail" width="5.00%">
                                    <span t-field="cl.invoice_date"/>
                                </td>
                                <td class="celdaDetailLeft" width="5.00%">
                                    <span t-esc="inv.move_id and inv.move_id.name.upper()"/>
                                </td>
                                <td class="celdaDetail" width="5.00%">
                                    <span t-field="cl.inv_subtotal"/>
                                </td>
                                <td class="celdaDetail" width="5.00%">
                                    <span t-field="cl.perc_iva"/>
                                </td>
                                <td class="celdaDetail" width="5.00%">

                                    <span t-field="inv.amount_total"/>
                                </td>
                                <td class="celdaDetail" width="5.00%">
                                    <span t-esc="cl.invoice_payment"/>
                                </td>

                                <td class="celdaDetail" width="5.00%">
                                    <span t-field="cl.rate_number"/>
                                </td>
                                <td class="celdaDetail" width="5.00%">
                                    <span t-field="cl.date_start"/>
                                </td>
                                <td class="celdaDetail" width="5.00%">
                                    <span t-field="cl.date_stop"/>
                                </td>
                                <td class="celdaDetail" width="5.00%">
                                    <span t-field="cl.days"/>
                                </td>
                                <td class="celdaDetail" width="5.00%">
                                    <span t-field="cl.timespan"/>
                                </td>
                                <td class="celdaDetail" width="5.00%">
                                    <span t-field="cl.baremo"/>
                                </td>
                                <td class="celdaDetail" width="5.00%">
                                    <span t-field="cl.currency_amount"/>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </t>
            </div>
            <p style="page-break-after:always"></p>
        </t>
    </template>

    <template id="salesman_report_template">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="o">
                <t t-call="commission_calculation.salesman_report" t-lang="o.salesman_id.partner_id.lang"/>
            </t>
        </t>
    </template>

    <template id="report_styles">
        <style type="text/css">
            table {
                border-collapse: separated;

            }
            table, th, td {
                border: 2px solid white;
            }
            table.basic_table{
            text-align:left;
            }

            .dest_address {
            font-size:12pt;
            margin-left:0;
            text-align:left;
            line-height:80%;
            padding-top:0px
            }

            .prueba{
            color:black;
            background-color:#dcdcdc;
            }


            .celdaTotalTitulo{
            font-size:11pt;
            text-align:left;
            font-weight:bold;
            font-family:Arial,Helvetica,sans-serif;
            background-color:#dcdcdc;
            }

            .celdaTotal{
            font-size:10pt;
            font-style:normal;
            font-family: FreeMono;
            text-align:right;
            font-weight:bold;
            background-color:#dcdcdc;
            }

            .celdaDetailTitulo{
            font-style:italic;
            font-size:11pt;
            text-align:left;
            font-family:Arial,Helvetica,sans-serif;
            background-color:#F5F5F5;
            }

            .celdaDetail{
            font-size:10pt;
            font-family: monospace;
            text-align:right;
            background-color:#F5F5F5;
            }

            .celdaDetailLeft{
            font-size:10pt;
            font-family: monospace;
            text-align:left;
            background-color:#F5F5F5;
            }

            .celdaAbstractTotal{
            font-size:11pt;
            text-align:left;
            font-family:Arial,Helvetica,sans-serif;
            background-color:#EAEAEA;
            }

            .celdaTituloTabla{
            font-size:11pt;
            text-align:left;
            font-family:Arial,Helvetica,sans-serif;
            background-color:#620400;
            color:#FFFFFF;
            }


            .celdaAbstract{
            font-size:10pt;
            font-family: monospace;
            text-align:right;
            background-color:#EAEAEA;
            }

            div.td_company
            {
            font-size:12pt;
            margin-left:0;
            font-weight:bold;
            font-family:Arial,Helvetica,sans-serif;
            }

            div.td_company_title
            {
            font-size:22pt;
            margin-left:0;
            font-weight:bold;
            font-family:Arial,Helvetica,sans-serif;
            }
        </style>
    </template>

</odoo>
